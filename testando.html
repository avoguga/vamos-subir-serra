<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste: Kuula em A-Frame VR</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

    <!-- Componente HTML Shader (experimental) -->
    <script src="https://unpkg.com/aframe-html-shader@0.2.0/dist/aframe-html-shader.min.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        /* A-Frame scene ocupa tela toda */
        a-scene {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
        }

        #info-overlay {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
            z-index: 10000;
            max-width: 400px;
            font-size: 14px;
        }

        #info-overlay h3 {
            margin-top: 0;
            color: #4CAF50;
        }

        #info-overlay button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        #info-overlay button:hover {
            background: #45a049;
        }

        /* Kuula overlay (M√©todo 3) */
        #kuula-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 9000;
        }

        #kuula-overlay.visible {
            display: block;
        }

        #kuula-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .method-label {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 152, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 9500;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Info Overlay -->
    <div id="info-overlay">
        <h3>üß™ Teste: Kuula + A-Frame VR</h3>
        <p><strong>3 M√©todos Experimentais:</strong></p>

        <button onclick="testMethod1()">1Ô∏è‚É£ HTML Shader (Screenshot)</button>
        <p style="font-size: 12px; margin: 5px 0;">Tenta capturar screenshot do iframe como textura</p>

        <button onclick="testMethod2()">2Ô∏è‚É£ Plano Transparente</button>
        <p style="font-size: 12px; margin: 5px 0;">Iframe atr√°s do canvas WebGL</p>

        <button onclick="testMethod3()">3Ô∏è‚É£ Overlay + VR Button</button>
        <p style="font-size: 12px; margin: 5px 0;">Iframe sobre A-Frame, entra VR manualmente</p>

        <hr style="margin: 15px 0; border-color: rgba(255,255,255,0.2);">

        <p><strong>üîÑ Ajustar Orienta√ß√£o:</strong></p>
        <button onclick="rotateScene(0)">‚Üë 0¬∞ (Padr√£o)</button>
        <button onclick="rotateScene(90)">‚Üí 90¬∞</button>
        <button onclick="rotateScene(180)">‚Üì 180¬∞</button>
        <button onclick="rotateScene(-90)">‚Üê -90¬∞</button>

        <button onclick="hideInfo()" style="background: #f44336; margin-top: 10px;">Fechar Info</button>
    </div>

    <!-- Method Label -->
    <div class="method-label" id="method-label" style="display: none;"></div>

    <!-- A-Frame VR Scene -->
    <a-scene id="vr-scene" vr-mode-ui="enabled: true">
        <a-assets>
            <!-- V√≠deo de teste -->
            <video id="test-video" src="./VSS 2025_09.webm" preload="auto" playsinline webkit-playsinline loop muted></video>
        </a-assets>

        <!-- Sky com v√≠deo inicial - Rota√ß√£o ajustada para orienta√ß√£o correta -->
        <a-sky id="video-sky" src="#test-video" rotation="0 -90 0"></a-sky>

        <!-- M√âTODO 1: Plano com HTML Shader -->
        <a-plane
            id="html-shader-plane"
            position="0 1.6 -3"
            width="4"
            height="2.25"
            visible="false"
            material="shader: html; target: #kuula-content; width: 1920; height: 1080; fps: 1">
        </a-plane>

        <!-- M√âTODO 2: Plano transparente para iframe -->
        <a-plane
            id="transparent-plane"
            position="0 1.6 -3"
            width="4"
            height="2.25"
            visible="false"
            material="opacity: 0; transparent: true">
        </a-plane>

        <!-- Texto informativo -->
        <a-text
            id="info-text"
            value="Clique nos botoes acima para testar"
            position="0 2.5 -3"
            align="center"
            color="#4CAF50"
            width="6">
        </a-text>

        <!-- Camera -->
        <a-camera position="0 1.6 0" look-controls wasd-controls></a-camera>

        <!-- Cursor para intera√ß√£o -->
        <a-cursor></a-cursor>
    </a-scene>

    <!-- M√âTODO 1: Container HTML para screenshot -->
    <div id="kuula-content" style="display: none; width: 1920px; height: 1080px;">
        <iframe
            src="https://kuula.co/share/collection/7H0RQ?logo=0&info=0&fs=0&vr=1&sd=1&thumbs=0"
            style="width: 100%; height: 100%; border: none;"
            allowfullscreen
            allow="xr-spatial-tracking; gyroscope; accelerometer; vr">
        </iframe>
    </div>

    <!-- M√âTODO 2: Iframe posicionado -->
    <iframe
        id="positioned-iframe"
        src=""
        style="position: fixed; display: none; width: 800px; height: 450px; z-index: 100; border: 2px solid #4CAF50;"
        allowfullscreen
        allow="xr-spatial-tracking; gyroscope; accelerometer; vr">
    </iframe>

    <!-- M√âTODO 3: Kuula Overlay -->
    <div id="kuula-overlay">
        <iframe
            id="kuula-iframe"
            src=""
            allowfullscreen
            allow="xr-spatial-tracking; gyroscope; accelerometer; vr; fullscreen">
        </iframe>
    </div>

    <script>
        // Configura√ß√£o
        const KUULA_URL = 'https://kuula.co/share/collection/7H0RQ?logo=0&info=0&fs=0&vr=1&sd=1&thumbs=0';

        const scene = document.querySelector('#vr-scene');
        const infoText = document.querySelector('#info-text');
        const methodLabel = document.querySelector('#method-label');
        const videoSky = document.querySelector('#video-sky');
        const testVideo = document.querySelector('#test-video');

        // Iniciar v√≠deo de fundo
        setTimeout(() => {
            testVideo.play().catch(e => console.log('Video autoplay blocked:', e));
        }, 500);

        function hideInfo() {
            document.getElementById('info-overlay').style.display = 'none';
        }

        function showMethodLabel(text) {
            methodLabel.textContent = text;
            methodLabel.style.display = 'block';
        }

        function updateInfoText(text) {
            infoText.setAttribute('value', text);
        }

        // ============================================
        // AJUSTAR ORIENTA√á√ÉO
        // ============================================
        function rotateScene(yRotation) {
            console.log('üîÑ Ajustando rota√ß√£o Y para: ' + yRotation + '¬∞');

            // Rotacionar o video sky
            videoSky.setAttribute('rotation', `0 ${yRotation} 0`);

            // Rotacionar o plano HTML shader tamb√©m
            const htmlPlane = document.getElementById('html-shader-plane');
            const currentPos = htmlPlane.getAttribute('position');

            // Mensagem de confirma√ß√£o
            showMethodLabel(`Rota√ß√£o: ${yRotation}¬∞`);
            updateInfoText(`Orientacao ajustada para: ${yRotation} graus\nGiroscopio continuara funcionando`);

            console.log(`‚úÖ Rota√ß√£o aplicada: Y = ${yRotation}¬∞`);
        }

        // ============================================
        // M√âTODO 1: HTML Shader (Screenshot)
        // ============================================
        function testMethod1() {
            console.log('üß™ Testing Method 1: HTML Shader');
            showMethodLabel('M√©todo 1: HTML Shader (Screenshot)');

            // Esconder outros elementos
            document.getElementById('transparent-plane').setAttribute('visible', false);
            document.getElementById('kuula-overlay').classList.remove('visible');
            document.getElementById('positioned-iframe').style.display = 'none';
            videoSky.setAttribute('visible', false);

            // Mostrar plano com shader
            const htmlPlane = document.getElementById('html-shader-plane');
            htmlPlane.setAttribute('visible', true);

            // Mostrar conte√∫do para screenshot
            document.getElementById('kuula-content').style.display = 'block';

            updateInfoText('Metodo 1: HTML Shader\nCaptura screenshot do iframe\nLIMITACAO: Nao interativo, apenas visual estatico');

            setTimeout(() => {
                alert('‚ö†Ô∏è LIMITA√á√ÉO DO M√âTODO 1:\n\n' +
                      '- Funciona apenas como SCREENSHOT est√°tico\n' +
                      '- N√ÉO √© interativo (n√£o pode navegar no tour)\n' +
                      '- Atualiza a cada 1 segundo (FPS baixo)\n' +
                      '- Iframe pode bloquear captura por CORS\n\n' +
                      'Resultado: Voc√™ ver√° uma imagem est√°tica do Kuula, sem intera√ß√£o.');
            }, 1000);
        }

        // ============================================
        // M√âTODO 2: Plano Transparente + Iframe Posicionado
        // ============================================
        function testMethod2() {
            console.log('üß™ Testing Method 2: Transparent Plane');
            showMethodLabel('M√©todo 2: Iframe Atr√°s do Canvas');

            // Esconder outros
            document.getElementById('html-shader-plane').setAttribute('visible', false);
            document.getElementById('kuula-overlay').classList.remove('visible');
            document.getElementById('kuula-content').style.display = 'none';
            videoSky.setAttribute('visible', false);

            // Mostrar plano transparente
            const transparentPlane = document.getElementById('transparent-plane');
            transparentPlane.setAttribute('visible', true);

            // Posicionar iframe
            const iframe = document.getElementById('positioned-iframe');
            iframe.style.display = 'block';
            iframe.src = KUULA_URL;

            // Calcular posi√ß√£o 2D aproximada do plano 3D
            // Centralizar na tela
            iframe.style.left = '50%';
            iframe.style.top = '50%';
            iframe.style.transform = 'translate(-50%, -50%)';

            updateInfoText('Metodo 2: Iframe Posicionado\nIframe atras do canvas WebGL\nLIMITACAO: NAO aparece em modo VR');

            setTimeout(() => {
                alert('‚ö†Ô∏è LIMITA√á√ÉO DO M√âTODO 2:\n\n' +
                      '- Iframe aparece em modo 2D normal\n' +
                      '- Quando entra em VR, o iframe DESAPARECE\n' +
                      '- WebGL canvas fica em primeiro plano\n' +
                      '- Imposs√≠vel sincronizar posi√ß√£o 3D com iframe\n\n' +
                      'Resultado: Funciona em 2D, quebra em VR.');
            }, 1000);
        }

        // ============================================
        // M√âTODO 3: Overlay Completo + VR Manual
        // ============================================
        function testMethod3() {
            console.log('üß™ Testing Method 3: Overlay + Manual VR');
            showMethodLabel('M√©todo 3: Kuula Overlay (MELHOR OP√á√ÉO)');

            // Esconder A-Frame
            document.getElementById('html-shader-plane').setAttribute('visible', false);
            document.getElementById('transparent-plane').setAttribute('visible', false);
            document.getElementById('positioned-iframe').style.display = 'none';
            document.getElementById('kuula-content').style.display = 'none';

            // Mostrar Kuula overlay
            const kuulaOverlay = document.getElementById('kuula-overlay');
            kuulaOverlay.classList.add('visible');

            const kuulaIframe = document.getElementById('kuula-iframe');
            kuulaIframe.src = KUULA_URL;

            setTimeout(() => {
                alert('‚úÖ M√âTODO 3 - MELHOR SOLU√á√ÉO PR√ÅTICA:\n\n' +
                      '1. Kuula carrega em tela cheia\n' +
                      '2. Girosc√≥pio funciona automaticamente\n' +
                      '3. Usu√°rio clica no bot√£o VR do Kuula\n' +
                      '4. Entra em modo VR estereosc√≥pico\n\n' +
                      'VANTAGENS:\n' +
                      '+ Tour completo do Kuula funciona\n' +
                      '+ Navega√ß√£o por hotspots\n' +
                      '+ VR real (tela dividida)\n\n' +
                      'DESVANTAGEM:\n' +
                      '- Requer clique manual no bot√£o VR\n\n' +
                      'Clique no bot√£o VR (√≠cone de √≥culos) no canto superior direito!');
            }, 1000);
        }

        // Detectar quando sai do VR
        scene.addEventListener('exit-vr', function() {
            console.log('Saiu do modo VR');
        });

        scene.addEventListener('enter-vr', function() {
            console.log('Entrou no modo VR');
        });

        // Log inicial
        console.log('üß™ Teste de integra√ß√£o Kuula + A-Frame VR carregado');
        console.log('M√©todos dispon√≠veis:');
        console.log('1. HTML Shader (screenshot est√°tico)');
        console.log('2. Iframe posicionado (n√£o funciona em VR)');
        console.log('3. Overlay completo (melhor op√ß√£o pr√°tica)');
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serra da Barriga VR - Alt</title>
    <!-- Usando A-Frame 1.0.4 - versão mais compatível -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <a-assets>
            <video id="video360"
                   src="VSS 2025_09.webm"
                   preload="auto"
                   autoplay
                   muted
                   loop="false"
                   playsinline
                   webkit-playsinline
                   crossorigin="anonymous">
            </video>
        </a-assets>

        <!-- Usando a-sky em vez de a-videosphere -->
        <a-sky src="#video360" rotation="0 -90 0"></a-sky>

        <a-camera>
            <a-cursor></a-cursor>
        </a-camera>
    </a-scene>

    <script>
        var video = document.getElementById('video360');
        var hasTransitioned = false;

        // Força play após interação
        document.querySelector('a-scene').addEventListener('click', function() {
            if (video.paused) {
                video.play();
            }
        });

        setTimeout(function() {
            video.muted = false;
            video.play().then(function() {
                console.log('Video playing!');
            }).catch(function(err) {
                console.log('Play error:', err);
            });
        }, 500);

        video.addEventListener('playing', function() {
            console.log('Video PLAYING event!');
        });

        video.addEventListener('timeupdate', function() {
            if (!hasTransitioned && video.currentTime >= 15) {
                notifyComplete();
            }
        });

        video.addEventListener('ended', function() {
            notifyComplete();
        });

        function notifyComplete() {
            if (hasTransitioned) return;
            hasTransitioned = true;

            console.log('Video complete - sending message');
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'video-complete' }, '*');
            }
        }
    </script>
</body>
</html>
